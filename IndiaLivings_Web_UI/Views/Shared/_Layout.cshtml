<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - IndiaLeavings</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    @* <link rel="stylesheet" href="~/India_Leavings_Web_UI.styles.css" asp-append-version="true" /> *@
    <!-- FAVICON -->
    <link rel="icon" href="images/favicon.png">

    <!-- FONTS -->
    @* <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha384-k6RqeWeci5ZR/Lv4MR0sA0FfDOMMb12QKmrCGLR7IxJ6kvTEh8P5F06IMj6mvZ0d" crossorigin="anonymous"> *@
    <link rel="stylesheet" href="~/fonts/flaticon/flaticon.css" />
    <link rel="stylesheet" href="~/fonts/font-awesome/fontawesome.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/custom/main.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/mvc-grid/mvc-grid.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/custom/services.css">
    @* <link rel="stylesheet" href="~/css/vendor/bootstrap.min.css" /> *@
    <style>
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            min-width: 250px;
            max-width: 350px;
            padding: 15px;
            border-radius: 4px;
            z-index: 9999;
            display: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            font-size: 1rem;
            animation: fadeIn 0.3s;
        }

        .toast-success {
            background-color: #4CAF50;
            color: white;
        }

        .toast-info {
            background-color: #2196F3;
            color: white;
        }

        .toast-message {
            background-color: #333;
            color: #fff;
        }
    </style>
</head>
<body>
    <div id="notification-toast" class="toast"></div>
    <partial name="~/Views/Shared/_Header.cshtml" />
    <partial name="~/Views/Shared/_SideBar.cshtml" />    
    <main role="main" class="pb-3">
        @RenderBody()
    </main>

    <partial name="~/Views/Shared/_Footer.cshtml" />
    <script type="text/javascript" src="~/js/mvc-grid/mvc-grid.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js"></script>
    <script src="~/js/vendor/slick.min.js"></script>
    <script src="~/js/custom/slick.js"></script>
    <script src="~/js/custom/main.js"></script>
    <script src="~/js/vendor/jquery-1.12.4.min.js"></script>
    <script src="~/js/vendor/popper.min.js"></script>
    <script src="~/js/vendor/bootstrap.min.js"></script>
    <script src="~/js/mvc-grid/mvc-grid.js"></script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/5.0.11/signalr.min.js"></script>
<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/notificationHub")
        .withAutomaticReconnect()
        .build();

    connection.start()
        .then(() => console.log("Connected to notification hub"))
        .catch(err => console.error(err));

    // Handle incoming notifications
    connection.on("ReceiveNotification", function(notification) {
        showToast(notification.message, notification.type);
        playNotificationSound();
        updateNotificationList(notification);
    });

    // Show in-page toast
    function showToast(message, type) {
        const toast = document.getElementById("notification-toast");
        toast.className = `toast toast-${type || "info"}`;
        toast.textContent = message;
        toast.style.display = "block";
        setTimeout(() => toast.style.display = "none", 5000);
    }

    // Play sound (preloaded to avoid decoding issues)
    function playNotificationSound() {
        let audio = document.getElementById("notificationSound");
        if (!audio) {
            // Create once if not exists
            audio = document.createElement("audio");
            audio.id = "notificationSound";
            audio.src = "/sounds/noti.mp3"; // file must exist in wwwroot/sounds/
            audio.preload = "auto";
            document.body.appendChild(audio);
        }
        audio.currentTime = 0; // restart
        audio.play().catch(err => console.log("Audio play failed:", err));
    }
</script>

