﻿﻿@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<header class="header-part">
    <div class="container">
        <div class="header-content">
            <div class="header-left">

                @if (!string.IsNullOrEmpty(Context.Session.GetString("userName")))
                {
                    <button type="button" class="header-widget sidebar-btn">
                        <i class="fas fa-align-left"></i>
                    </button>
                }
                <a class="text-dark header-logo" asp-area="" asp-controller="Dashboard" asp-action="Dashboard">
                    <img src="@Url.Content("~/images/logo.png")" alt="logo">
                </a>
                @if (string.IsNullOrEmpty(Context.Session.GetString("userName")))
                {
                    <a class="text-dark header-widget header-user" asp-area="" asp-controller="Dashboard" asp-action="Login">
                        <img src="@Url.Content("~/images/user.png")" alt="user">
                        <span>Join Me</span>
                    </a>
                }

                <button type="button" class="header-widget search-btn">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <form class="header-form">
                <div class="header-search">
                    <button type="button" title="Search Submit" onclick="ProductsSearch()"><i class="fas fa-search"></i></button>
                    <input type="text" onfocus="opennavdrop()" class="option-btn" id="productName" placeholder="Search for a Product...">
                    <button type="button" title="Search Option" id="optionbtn" class="option-btn" onclick="opennavdrop()"><i class="fas fa-sliders-h"></i></button>
                </div>
                <div class="header-option">
                    <div class="option-grid">
                        <div class="option-group"><select id="stateDropdown" class="form-control" value="" placeholder="Select a State"></select></div>
                        <div class="option-group"><select id="cityDropdown" class="form-control" value="" placeholder="Select a City"><option value="" disabled selected>Select a State for Cities</option></select></></div>
                        <div class="option-group"><input type="text" id="minPrice" placeholder="Min Price"></div>
                        <div class="option-group"><input type="text" id="maxPrice" placeholder="Max Price"></div>
                        <button type="button" onclick="ProductsSearch()"><i class="fas fa-search"></i><span>Search</span></button>
                    </div>
                </div>
            </form>
                <div class="header-right">
                    @if (!string.IsNullOrEmpty(Context.Session.GetString("userName")))
                    {
                        <ul class="header-list">
                            <li class="header-item">
                                <a href="~/User/Bookmark" class="header-widget">
                                    <i class="fas fa-heart"></i>
                                    <sup class="wishlist-count">@Context.Session.GetInt32("wishlistCount")</sup>
                                </a>
                            </li>
                            <li class="header-item">
                                <a href="~/service/ServicesList" class="header-widget">
                                    <i class="fas fa-tools"></i>
                                    @* <span>Services</span> *@
                                </a>
                            </li>
                            <li class="header-item">
                            <a href="~/User/Message" type="button" class="header-widget">
                                    <i class="fas fa-envelope"></i>
                                    <sup class="msg-count">0</sup>
                                </a>
                            </li>
                            <li class="header-item">
                                <a href="~/User/Notification" type="button" class="header-widget">
                                    <i class="fas fa-bell"></i>
                                    <sup class="notification-count">0</sup>
                                </a>
                            </li>
                        </ul>
                    }
                    <a asp-controller="User" asp-action="PostAd" class="btn btn-inline post-btn">
                        <i class="fas fa-plus-circle"></i>
                        <span>post your ad</span>
                    </a>
                </div>
        </div>
    </div>
</header>
<script>

    function ProductsSearch() {
        var selectedCity = $('#cityDropdown option:selected').text();
        var selectedState = $('#stateDropdown option:selected').text();

        var city = (selectedCity === "Select a City" || selectedCity === "Select a State for Cities") ? "" : selectedCity;
        var state = (selectedState === "Select a State") ? "" : selectedState;
        var minPrice = $('#minPrice').val();
        var maxPrice = $('#maxPrice').val();
        var productName = $('#productName').val();

        // Construct query string from inputs
        var queryParams = `?strProductName=${encodeURIComponent(productName)}&strCity=${encodeURIComponent(city)}&strState=${encodeURIComponent(state)}&decMinPrice=${encodeURIComponent(minPrice)}&decMaxPrice=${encodeURIComponent(maxPrice)}`;

        // Navigate to the AdsList page with query params
        window.location.href = '/Dashboard/navSearch' + queryParams;
      }
    function opennavdrop() {
        $.ajax({
                    url: '/Dashboard/GetStates',
                    type: 'GET',
                    data: {countryId: 91},
                    success: function (states) {
                        if (typeof states === "string") {
                            states = JSON.parse(states);
                        }

                        const filteredStates = states
                            .filter(s => s && s.strStateName && s.IsActive)
                            .sort((a, b) => a.strStateName.localeCompare(b.strStateName));

                        let $stateDropdown = $('#stateDropdown');
                        $stateDropdown.empty().append('<option>Select a State</option>');

                        filteredStates.forEach(function (state) {
                            $stateDropdown.append(
                                $('<option></option>')
                                    .val(state.intStateID)
                                    .text(state.strStateName)
                            );
                        });

                        $stateDropdown.select1({
                            placeholder: "Select a State",
                            allowClear: true
                        });
                        $stateDropdown.val("").trigger('change');
                        //}


                    },
                    error: function () {
                        alert('Failed to load states');
                    }
                });
        $('#stateDropdown').on('change', function () {
            const selectedStateId = $(this).val();
            if (selectedStateId) {
                $.ajax({
                    url: '/Dashboard/GetCities',
                    type: 'GET',
                    data: {stateId: selectedStateId},
                    success: function (cities) {
                        if (typeof cities === "string") {
                            cities = JSON.parse(cities);
                        }

                        const filteredCities = cities
                            .filter(s => s && s.strCityName && s.IsActive)
                            .sort((a, b) => a.strCityName.localeCompare(b.strCityName));

                        let $cityDropdown = $('#cityDropdown');
                        $cityDropdown.empty().append('<option>Select a City</option>');

                        filteredCities.forEach(function (city) {
                            $cityDropdown.append(
                                $('<option></option>')
                                    .val(city.intCityID)
                                    .text(city.strCityName)
                            );
                        });

                        $cityDropdown.select1({
                            placeholder: "Select a City",
                            allowClear: true
                        });
                        $cityDropdown.val("").trigger('change');
                    },
                    error: function () {
                        alert('Failed to load cities');
                    }
                });
            } else {
                $('#cityDropdown').empty().trigger('change');
            }
        });
    }
</script>