@{
    var Error_Message = TempData["Error_Message"];
}
@{
    ViewBag.Title = "User Form";
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - India_Leavings</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    @* <link rel="stylesheet" href="~/India_Leavings_Web_UI.styles.css" asp-append-version="true" /> *@
    <!-- FAVICON -->
    <link rel="icon" href="images/favicon.png">

    <!-- FONTS -->
    <link rel="stylesheet" href="~/fonts/flaticon/flaticon.css" />
    <link rel="stylesheet" href="~/fonts/font-awesome/fontawesome.css" />
    <link rel="stylesheet" href="~/css/custom/main.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/custom/user-form.css">
    @* <link rel="stylesheet" href="~/css/vendor/bootstrap.min.css" /> *@
    <script src="~/js/custom/login.js"></script>
    <style>

        /* Toast container */
        .toast_success {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 9999;

            transition: opacity 0.3s ease, visibility 0.3s ease;

        }

        .toast_failed {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #dc3545;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 9999;
            transition: opacity 0.3s ease, visibility 0.3s ease;

        }



        .valid {
            color: green;
        }

        .invalid {
            color: red;
        }

        .tick {
            color: green;
            font-size: 24px;
            visibility: hidden;
        }
    </style>
</head>
<body>

    <!--=====================================
                USER-FORM PART START
    =======================================-->
    <section class="user-form-part">
        <div class="user-form-banner">
            <div class="user-form-content">
                <a href="#"><img src="/images/logo.png" alt="logo"></a>
                <h1>Advertise your assets <span>Buy what are you needs.</span></h1>
                <p>Biggest Online Advertising Marketplace in the World.</p>
            </div>
        </div>

        <div class="user-form-category">
            <div class="user-form-header">
                <a href="#"><img src="/images/logo.png" alt="logo"></a>
                <a href="/"><i class="fas fa-arrow-left"></i></a>
            </div>
            <div class="user-form-category-btn">
                <ul class="nav nav-tabs">
                    <li>
                        <a href="#login-tab" aria-controls="login-tab" class="nav-link active" role="tab" data-toggle="tab">Sign in</a>
                    </li>
                    <li>
                        <a href="#register-tab" aria-controls="register-tab" class="nav-link" role="tab" data-toggle="tab">Sign up</a>
                    </li>                       
                </ul>
            </div>
            <div class="tab-pane active" id="login-tab">
                <div class="user-form-title">
                    <h2>Welcome!</h2>
                    <p>Use credentials to access your account.</p>
                </div>
                <form id="loginForm" asp-action="MasterPage" asp-controller="Dashboard" method="post">
                    <div class="row">
                        <div class="col-12">
                            <div class="form-group">
                                <input type="text" class="form-control" 
                                placeholder="Phone number or Email" id="phone" 
                                name="phone" autocomplete="off" />
                                <small id="phoneError" class="text-danger" style="display:none;"></small>
                                <small class="form-alert">Kindly use this format: +91 xxxxxxxxxx or username@gmail.com.</small>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <input type="password" class="form-control" placeholder="Password"
                                id="password" name="password" />
                                <div id="toggle_Signin_pswd" class="form-icon" 
                                onclick="fn_toggle_pswd('password','toggle_Signin_pswd');"><i class="eye fas fa-eye-slash"></i></div>
                                <small id="passwordError" class="text-danger" style="display:none;"></small>
                                <small class="form-alert">Password must be 6 characters</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group">
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="signin-check">
                                    <label class="custom-control-label" for="signin-check">Remember me</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-group text-right">
                                <a href="#" class="form-forgot">Forgot password?</a>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <button type="button" class="btn btn-inline" onclick="Check_User()">
                                    <i class="fas fa-unlock"></i>
                                    <span>Enter your account</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="user-form-direction">
                    <p>
                        Already have an account? click on the
                        <a href="#register-tab" aria-controls="register-tab" class="nav-link" role="tab" data-toggle="tab">Sign up</a>
                        button above.
                    </p>
                </div>
            </div>

            <div class="tab-pane" id="register-tab">
                <div class="user-form-title">
                    <h2>Register</h2>
                    <p>Setup a new account in a minute.</p>
                </div>
                <form>
                    <div class="row">
                        <div class="col-12">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Phone number">
                                <small class="form-alert">Please follow this example - 01XXXXXXXXX</small>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <input type="password" class="form-control" placeholder="Password">
                                <button class="form-icon"><i class="eye fas fa-eye"></i></button>
                                <small class="form-alert">Password must be 6 characters</small>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <input type="password" class="form-control" placeholder="Repeat Password">
                                <button class="form-icon"><i class="eye fas fa-eye"></i></button>
                                <small class="form-alert">Password must be 6 characters</small>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" id="signup-check">
                                    <label class="custom-control-label" for="signup-check">I agree to the all <a href="#">terms & consitions</a> of bebostha.</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <button type="submit" class="btn btn-inline">
                                    <i class="fas fa-user-check"></i>
                                    <span>Create new account</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="user-form-direction">
                    <p>Already have an account? click on the
                        <a href="#login-tab" aria-controls="login-tab" class="nav-link active" role="tab" data-toggle="tab">Sign in</a>
                        button above.
                    </p>
                </div>
            </div>

            <div id="toast-container"></div>
        </div>


    </section>
    <!--=====================================
                USER-FORM PART END
    =======================================-->
    <!--=====================================
                JS LINK PART START
    =======================================-->
    <!-- FOR BOOTSTRAP -->
    <script src="~/js/vendor/jquery-1.12.4.min.js"></script>
    <script src="~/js/vendor/popper.min.js"></script>
    <script src="~/js/vendor/bootstrap.min.js"></script>

    <!-- FOR INTERACTION -->
    <script src="~/js/custom/main.js"></script>
    <!--=====================================
                JS LINK PART END
    =======================================-->

    <script type="text/javascript">       

        function validatePhoneNumber(event) {
            return false;
            const key = event.key;

            if (!/^\d$/.test(key)) {
                event.preventDefault();
            }
            const phoneInput = document.getElementById("phone");
            const phoneError = document.getElementById("phoneError");
            const phoneValue = phoneInput.value.trim();

            const phoneInputSignup = document.getElementById("phoneSignup");
            const phoneErrorSignup = document.getElementById("phoneErrorSignup");
            const phoneValueSignup = phoneInputSignup.value.trim();

            if (phoneValue.length < 10) {
                phoneError.style.display = "none";
            }
            if (phoneValueSignup.length < 10) {
                phoneErrorSignup.style.display = "none";
            }
        }

        function validatePasssword() {

            const passwordInput = document.getElementById("password");
            const passwordError = document.getElementById("passwordError");
            const passwordValue = passwordInput.value.trim();

            const passwordInputSignup = document.getElementById("passwordSignup");
            const passwordErrorSignup = document.getElementById("passwordErrorSignup");
            const passwordValueSignup = passwordInputSignup.value.trim();

            passwordError.style.display = "none";

            passwordErrorSignup.style.display = "none";
        }

        function validateConfirmPasssword() {

            const confirmPasswordInput = document.getElementById("confirmPassword");
            const confirmPasswordError = document.getElementById("confirmPasswordError");
            const confirmPasswordValue = confirmPasswordInput.value.trim();

            confirmPasswordError.style.display = "none";
        }
        function validateOnClick() {
            const phoneInput = document.getElementById("phone");
            const phoneError = document.getElementById("phoneError");
            const phoneValue = phoneInput.value.trim();

            const phoneInputSignup = document.getElementById("phoneSignup");
            const phoneErrorSignup = document.getElementById("phoneErrorSignup");
            const phoneValueSignup = phoneInput.value.trim();

            const passwordInput = document.getElementById("password");
            const passwordError = document.getElementById("passwordError");
            const passwordValue = passwordInput.value.trim();

            const passwordInputSignup = document.getElementById("passwordSignup");
            const passwordErrorSignup = document.getElementById("passwordErrorSignup");
            const passwordValueSignup = passwordInput.value.trim();

            phoneError.style.display = "none";
            passwordError.style.display = "none";
            phoneErrorSignup.style.display = "none";
            passwordErrorSignup.style.display = "none";

            let isValid = true;

            if (phoneValue === "") {
                phoneError.textContent = "please enter the phone number";
                phoneError.style.display = "block";
                isValid = false;
            } else if (phoneValue.length !== 10) {
                phoneError.textContent = "phone number must be exactly 10 digits";
                phoneError.style.display = "block";
                isValid = false;
            }

            if (passwordValue === "") {
                passwordError.textContent = "please enter the password";
                passwordError.style.display = "block";
                isValid = false;
            } else if (passwordValue.length < 6) {
                passwordError.textContent = "password must be at least 6 characters long";
                passwordError.style.display = "block";
                isValid = false;
            }

            if (isValid) {
                document.getElementById("loginForm").submit();
            } else {
                event.preventDefault();
            }
        }

        function validateOnSignup() {
            const phoneInputSignup = document.getElementById("phoneSignup");
            const phoneErrorSignup = document.getElementById("phoneErrorSignup");
            const phoneValueSignup = phoneInputSignup.value.trim();

            const passwordInputSignup = document.getElementById("passwordSignup");
            const passwordErrorSignup = document.getElementById("passwordErrorSignup");
            const passwordValueSignup = passwordInputSignup.value.trim();

            const confirmPassword = document.getElementById("confirmPassword");
            const confirmPaswordError = document.getElementById("confirmPasswordError");
            const confirmPasswordValue = confirmPassword.value.trim();

            const checkbox = document.getElementById("signupCheck");
            const checkboxError = document.getElementById("checkboxError");
            const checkboxValue = checkbox.value.trim();

            phoneErrorSignup.style.display = "none";
            passwordErrorSignup.style.display = "none";
            confirmPassword

            let isValid = true;

            if (phoneValueSignup === "") {
                phoneErrorSignup.textContent = "please enter the phone number";
                phoneErrorSignup.style.display = "block";
                isValid = false;
            } else if (phoneValueSignup.length !== 10) {
                phoneErrorSignup.textContent = "phone number must be exactly 10 digits";
                phoneErrorSignup.style.display = "block";
                isValid = false;
            }

            if (passwordValueSignup === "") {
                passwordErrorSignup.textContent = "please enter the password";
                passwordErrorSignup.style.display = "block";
                isValid = false;
            } else if (passwordValueSignup.length < 6) {
                passwordErrorSignup.textContent = "password must be at least 6 characters long";
                passwordErrorSignup.style.display = "block";
                isValid = false;
            }

            if (isValid) {
                if (confirmPasswordValue === "") {
                    confirmPasswordError.textContent = "please retype your password";
                    confirmPasswordError.style.display = "block";
                    isValid = false;
                } else if (confirmPasswordValue !== passwordValueSignup) {
                    confirmPasswordError.textContent = "passwords do not match";
                    confirmPasswordError.style.display = "block";
                    isValid = false;
                }
            }

            if (isValid) {
                if (!checkbox.checked) {
                    checkboxError.textContent = "you must agree to the terms and conditions";
                    checkboxError.style.display = "block";
                    isValid = false;
                }
            }

            if (isValid) {
                document.getElementById("signupForm").submit();
            } else {
                event.preventDefault();
            }

        }


        // Register the User
        var User_Type= "";
        function Add_User() {
            //showToast('Added User','Success');
            //alert('Failed');
            //showToast('Added User','Failed');

            if(!validate_SignUp())
            return false;

            if(!validate_RepeatPassword())
            return false;

            const checkbox = document.getElementById("signupCheck");

            if (!checkbox.checked) {
                    checkboxError.textContent = "you must agree to the terms and conditions";
                    checkboxError.style.display = "block";
                    return false;
            }

            // Get the values from the fields
             var UserData = {
                Phone_Email: document.getElementById('phoneSignup').value,
                Password: document.getElementById('passwordSignup').value,
                UserType: User_Type
            };

            // Perform the AJAX request
            $.ajax({
                url: '@Url.Action("CreateUser", "Dashboard")',
                type: 'POST',  // Use POST method to send data
                data: UserData,  // Send data to the controller
                success: function(response) {
                // Save logic here (you can send an AJAX request to save these values to the database) Save_Category(' + categoryId     +   ')
                 //alert(response);
                 if(response == "Add User Failed. Please check with Admin.")
                 {
                     showToast(response,'Failed');

                     return false;
                 }
                 showToast(response,'Success');

                 HideSignUp_ErrorTags('Phone_Email');
                 HideSignUp_ErrorTags('Password');
                 clear_signup_fields();


                 },
                error: function(xhr, status, error) {
                    // Handle error
                    // console.log(error);
                    //alert("An error occurred: " + error);
                            showToast('An error has occurred. Please contact IndiaLivings support for assistance','Failed');

                }
            });
        }


        // Login the User
        function Check_User() {
            if(!validate_login())
            return false;

            // Get the values from the fields

             var UserData = {
                userName: document.getElementById('phone').value,
                password: document.getElementById('password').value
            };


            // Perform the AJAX request
            $.ajax({
                url: '@Url.Action("Login", "Dashboard")',
                type: 'POST',  // Use POST method to send data
                data: UserData,  // Send data to the controller
                success: function(response) {
                // Save logic here (you can send an AJAX request to save these values to the database) Save_Category(' + categoryId     +   ')

                 if(response.error_Message == "Failed"){
                     showToast('The username or password you entered is incorrect. Please try again...','Failed');

                  // alert('The username or password you entered is incorrect. Please try again...');
                    return false;
                 }

                 clear_signin_fields();
                 if(response.userRoleName == "User")
                     window.location.href = "/UserDashboard/Dashboard?userId=" + response.userID;
                 else
                     window.location.href = "/Dashboard/MasterPage?userId=" + response.userID;


                 //document.getElementById("loginForm").submit();


                },
                error: function(xhr, status, error) {
                    // Handle error
                    //console.log(error);
                    //alert("An error occurred: " + error);


                     showToast('An error has occurred. Please contact IndiaLivings support for assistance','Failed');
                }
            });

        }
        </script>
</body>

</html>