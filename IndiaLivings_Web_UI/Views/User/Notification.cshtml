<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="~/css/vendor/nice-select.min.css">
    <link rel="stylesheet" href="~/css/custom/notification.css">
    <style>
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            border-radius: 4px;
            z-index: 9999;
            display: none;
        }
        .toast-success { background-color: #4CAF50; color: white; }
        .toast-info { background-color: #2196F3; color: white; }
    </style>
</head>
<body>
    <div id="notification-toast" class="toast"></div>
    <!--=====================================
              NOTIFICATION PART START
    =======================================-->
    <section class="notify-part">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 mx-auto">
                    <div class="notify-body">
                        <div class="notify-filter">
                            <select class="select notify-select" id="notificationFilter">
                                <option value="all">all notification</option>
                                <option value="read">read notification</option>
                                <option value="unread">unread notification</option>
                            </select>
                            <div class="notify-action">
                                <a href="#" title="Delete All" class="fas fa-trash-alt" id="deleteAllNotifications"></a>
                                <a href="#" title="Mark All As Read" class="fas fa-envelope-open" id="markAllAsRead"></a>
                                <a href="#" title="Notification Setting" class="fas fa-cog"></a>
                            </div>
                        </div>
                        <ul class="notify-list notify-scroll" id="notificationList">
                            @foreach (var notification in Model)
                            {
                                @* <li class="notify-item @(notification.IsRead ? "" : "active") data-id="@notification.Id"> *@
                                <li class="notify-item">
                                    <a href="#" class="notify-link">
                                        <div class="notify-img">
                                            <img src="~/images/user.png" alt="avatar" onerror="this.src='/images/user.png';">
                                        </div>
                                        <div class="notify-content">
                                            <p class="notify-text">@Html.Raw(notification.LastMessage)</p>
                                            <span class="notify-time">@notification.LastMessageTime</span>
                                        </div>
                                    </a>
                                </li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--=====================================
              NOTIFICATION PART END
    =======================================-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/5.0.11/signalr.min.js"></script>
    <script>
        // Initialize SignalR connection
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/notificationHub")
            .withAutomaticReconnect()
            .build();

        connection.start()
            .then(() => console.log("Connected to notification hub"))
            .catch(err => console.error("Error connecting to notification hub:", err));

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.getElementById('notification-toast');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // Add new notification to the list
        function addNotificationToList(notification) {
            const notificationHtml = `
                <li class="notify-item active" data-id="${notification.id ?? ''}">
                    <a href="${notification.link ?? '#'}" class="notify-link">
                        <div class="notify-img">
                            <img src="${notification.imageUrl ?? '/images/user.png'}" alt="avatar" onerror="this.src='/images/user.png';">
                        </div>
                        <div class="notify-content">
                            <p class="notify-text">${notification.message}</p>
                            <span class="notify-time">just now</span>
                        </div>
                    </a>
                </li>`;
            document.getElementById('notificationList').insertAdjacentHTML('afterbegin', notificationHtml);
        }
    </script>
</body>
</html>