@model IEnumerable<IndiaLivings_Web_UI.Models.InvoiceViewModel>
@using NonFactors.Mvc.Grid
@{
    ViewBag.Title = "Membership";
    <link rel="stylesheet" href="~/fonts/flaticon/flaticon.css" />
    <link rel="stylesheet" href="~/fonts/font-awesome/fontawesome.css" />
}

<style>
    /* Invoice Page Specific Styles */
    .invoice-page-header {
        background: linear-gradient(135deg, var(--primary) 0%, #0033aa 100%);
        color: var(--white);
        padding: 40px 0;
        margin-bottom: 40px;
        border-radius: 0;
    }

    .invoice-page-header h1 {
        color: var(--white);
        font-size: 32px;
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .invoice-page-header p {
        color: rgba(255, 255, 255, 0.85);
        margin-top: 8px;
        font-size: 15px;
    }

    .invoice-page-header i {
        font-size: 28px;
    }

    /* Statistics Cards */
    .invoice-stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .invoice-stat-card {
        background: var(--white);
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border-left: 4px solid var(--primary);
        transition: all linear 0.3s;
    }

    .invoice-stat-card:hover {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        transform: translateY(-2px);
    }

    .invoice-stat-card.pending {
        border-left-color: #ffab10;
    }

    .invoice-stat-card.completed {
        border-left-color: #11b76b;
    }

    .invoice-stat-card.total {
        border-left-color: var(--primary);
    }

    .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        margin-bottom: 12px;
    }

    .stat-icon.pending {
        background: rgba(255, 171, 16, 0.15);
        color: #ffab10;
    }

    .stat-icon.completed {
        background: rgba(17, 183, 107, 0.15);
        color: #11b76b;
    }

    .stat-icon.total {
        background: rgba(0, 68, 187, 0.15);
        color: var(--primary);
    }

    .stat-label {
        font-size: 13px;
        color: var(--gray);
        text-transform: uppercase;
        font-weight: 500;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
    }

    .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: var(--heading);
        font-family: 'Courier New', monospace;
    }

    /* Invoice Table Container */
    .invoice-table-container {
        background: var(--white);
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        margin-bottom: 30px;
    }

    .invoice-table-header {
        padding: 25px;
        background: linear-gradient(135deg, #f8f9fa 0%, #f0f2f5 100%);
        border-bottom: 2px solid #e8e8e8;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .invoice-table-header h3 {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
        color: var(--heading);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .invoice-table-header i {
        color: var(--primary);
        font-size: 20px;
    }

    .invoice-filter-section {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .invoice-filter-btn {
        padding: 8px 16px;
        border-radius: 6px;
        border: 1px solid #e8e8e8;
        background: var(--white);
        color: var(--gray);
        font-size: 13px;
        cursor: pointer;
        transition: all linear 0.3s;
    }

    .invoice-filter-btn:hover,
    .invoice-filter-btn.active {
        background: var(--primary);
        color: var(--white);
        border-color: var(--primary);
    }

    /* MVC Grid Customization */
    .mvc-grid {
        border: none;
        font-size: 15px;
    }

    .mvc-grid-table > table {
        margin: 0;
    }

    .mvc-grid-table > table > thead > tr > th {
        background: #f8f9fa;
        color: var(--heading);
        font-weight: 600;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: 2px solid #e8e8e8;
        border-top: none;
        padding: 16px;
        white-space: nowrap;
    }

    .mvc-grid-table > table > thead > tr > th:first-child {
        border-left: none;
    }

    .mvc-grid-table > table > tbody > tr > td {
        border: none;
        border-bottom: 1px solid #f0f0f0;
        padding: 16px;
        vertical-align: middle;
    }

    .mvc-grid-table > table > tbody > tr:hover {
        background-color: #f8f9fa;
        transition: background-color 0.2s;
    }

    .mvc-grid-table > table > tbody > tr:last-child > td {
        border-bottom: none;
    }

    /* Status Badge */
    .invoice-status-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 50px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.3px;
        white-space: nowrap;
    }

    .status-pending {
        background: rgba(255, 171, 16, 0.15);
        color: #ff9500;
    }

    .status-completed {
        background: rgba(17, 183, 107, 0.15);
        color: #11b76b;
    }

    .status-paid {
        background: rgba(17, 183, 107, 0.15);
        color: #11b76b;
    }

    .status-overdue {
        background: rgba(255, 56, 56, 0.15);
        color: #ff3838;
    }

    .status-cancelled {
        background: rgba(119, 119, 119, 0.15);
        color: #777777;
    }

    /* Invoice ID & Number */
    .invoice-id-cell {
        font-family: 'Courier New', monospace;
        font-weight: 600;
        color: var(--primary);
        font-size: 13px;
    }

    .invoice-plan-cell {
        font-weight: 500;
        color: var(--heading);
    }

    .invoice-price-cell {
        font-weight: 600;
        color: var(--heading);
        font-family: 'Courier New', monospace;
        font-size: 15px;
    }

    .invoice-type-cell {
        font-size: 13px;
        font-weight: 500;
        text-transform: capitalize;
        padding: 6px 12px;
        background: #f0f2f5;
        border-radius: 6px;
        display: inline-block;
    }

    .invoice-date-cell {
        font-size: 13px;
        color: var(--gray);
    }

    /* Pagination */
    .mvc-grid-pager {
        padding: 20px 25px;
        background: #f8f9fa;
        border-top: 1px solid #e8e8e8;
    }

    .mvc-grid-pager button {
        border: 1px solid #e0e0e0;
        background: var(--white);
        color: var(--primary);
        border-radius: 4px;
        min-width: 35px;
        height: 35px;
        font-weight: 500;
        transition: all linear 0.3s;
    }

    .mvc-grid-pager button:hover:not([disabled]) {
        background: var(--primary);
        color: var(--white);
        border-color: var(--primary);
    }

    .mvc-grid-pager .active {
        background: var(--primary);
        color: var(--white);
        border-color: var(--primary);
    }

    .mvc-grid-pager [disabled] {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Empty State */
    .mvc-grid-empty-row {
        padding: 60px 20px;
        background: #f8f9fa;
        color: var(--gray);
        font-size: 16px;
    }

    .mvc-grid-empty-row i {
        font-size: 48px;
        color: #cccccc;
        margin-bottom: 15px;
    }

    /* Action Section */
    .invoice-action-section {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
    }

    .invoice-export-btn,
    .invoice-download-btn {
        padding: 10px 20px;
        border-radius: 6px;
        border: 1px solid var(--primary);
        background: var(--white);
        color: var(--primary);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all linear 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .invoice-export-btn:hover,
    .invoice-download-btn:hover {
        background: var(--primary);
        color: var(--white);
    }

    /* Responsive Design */
    @@media (max-width: 1200px) {
        .invoice-stats-container {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @@media (max-width: 768px) {
        .invoice-page-header {
            padding: 25px 0;
            margin-bottom: 25px;
        }

        .invoice-page-header h1 {
            font-size: 24px;
        }

        .invoice-stats-container {
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .invoice-table-header {
            padding: 15px;
            flex-direction: column;
            align-items: flex-start;
        }

        .invoice-table-header h3 {
            font-size: 18px;
            margin-bottom: 12px;
        }

        .invoice-filter-section {
            width: 100%;
        }

        .mvc-grid-table > table > thead > tr > th {
            padding: 12px;
            font-size: 12px;
        }

        .mvc-grid-table > table > tbody > tr > td {
            padding: 12px;
            font-size: 13px;
        }

        .invoice-action-section {
            flex-direction: column;
        }

        .invoice-export-btn,
        .invoice-download-btn {
            width: 100%;
            justify-content: center;
        }
    }

    @@media (max-width: 576px) {
        .invoice-table-header {
            padding: 12px;
        }

        .invoice-table-header h3 {
            font-size: 16px;
        }

        .mvc-grid-table > table > thead > tr > th {
            padding: 10px 8px;
            font-size: 11px;
        }

        .mvc-grid-table > table > tbody > tr > td {
            padding: 10px 8px;
            font-size: 12px;
        }

        .stat-value {
            font-size: 22px;
        }

        .invoice-id-cell {
            font-size: 11px;
        }
    }

    /* No Data State */
    .invoice-no-data {
        text-align: center;
        padding: 60px 20px;
    }

    .invoice-no-data i {
        font-size: 64px;
        color: #ddd;
        margin-bottom: 20px;
    }

    .invoice-no-data h4 {
        color: var(--gray);
        margin-bottom: 10px;
    }

    .invoice-no-data p {
        color: #aaa;
        font-size: 14px;
    }
</style>

<div class="invoice-page-header">
    <div class="container">
        <h1>
            <i class="fas fa-file-invoice-dollar"></i>
            Invoice Management
        </h1>
        <p>View and manage all your invoices and payments in one place</p>
    </div>
</div>

<div class="container" style="margin-top: 20px;">
    <!-- Statistics Section -->
    <div class="invoice-stats-container">
        <div class="invoice-stat-card total">
            <div class="stat-icon total">
                <i class="fas fa-file-invoice"></i>
            </div>
            <div class="stat-label">Total Invoices</div>
            <div class="stat-value">@Model.Count()</div>
        </div>

        <div class="invoice-stat-card pending">
            <div class="stat-icon pending">
                <i class="fas fa-hourglass-half"></i>
            </div>
            <div class="stat-label">Pending Invoices</div>
            <div class="stat-value">
                @Model.Count(x => x.Status == IndiaLivings_Web_DAL.Models.InvoiceStatus.PENDING)
            </div>
        </div>

        <div class="invoice-stat-card completed">
            <div class="stat-icon completed">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-label">Completed Invoices</div>
            <div class="stat-value">
                @Model.Count(x => x.Status == IndiaLivings_Web_DAL.Models.InvoiceStatus.SUCCESS)
            </div>
        </div>

        <div class="invoice-stat-card total">
            <div class="stat-icon total">
                <i class="fas fa-rupiah-sign"></i>
            </div>
            <div class="stat-label">Total Amount</div>
            <div class="stat-value">
                ₹@Model.Sum(x => x.invoiceTotal).ToString("N0")
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="invoice-action-section">
        <button class="invoice-export-btn" onclick="exportToCSV()">
            <i class="fas fa-download"></i>
            Export CSV
        </button>
        <button class="invoice-download-btn" onclick="printInvoices()">
            <i class="fas fa-print"></i>
            Print
        </button>
    </div>

    <!-- Invoice Table Container -->
    <div class="invoice-table-container">
        <div class="invoice-table-header">
            <h3>
                <i class="fas fa-list"></i>
                Invoice Details
            </h3>
            <div class="invoice-filter-section">
                <button class="invoice-filter-btn active" onclick="filterInvoices('all', this)">
                    <i class="fas fa-list"></i> All
                </button>
                <button class="invoice-filter-btn" onclick="filterInvoices('pending', this)">
                    <i class="fas fa-hourglass-half"></i> Pending
                </button>
                <button class="invoice-filter-btn" onclick="filterInvoices('paid', this)">
                    <i class="fas fa-check-circle"></i> Paid
                </button>
            </div>
        </div>

        <div style="overflow-x: auto;">
            @if (Model.Any())
            {
                @(
                    Html.Grid(Model).Build(col =>
                    {
                        col.Add(Model => Model.intInvoiceID)
                            .Titled("Invoice ID")
                            .Css("text-center")
                            .Encoded(false)
                            .RenderedAs(model => $"<span class='invoice-id-cell'>#{model.intInvoiceID}</span>");

                        col.Add(Model => Model.invoiceNumber)
                            .Titled("Plan")
                            .Css("text-center")
                            .Encoded(false)
                            .RenderedAs(model => $"<span class='invoice-plan-cell'>{model.invoiceNumber}</span>");

                        col.Add(Model => Model.invoiceTotal)
                            .Titled("Amount")
                            .Css("text-center")
                            .Encoded(false)
                            .RenderedAs(model => $"<span class='invoice-price-cell'>₹{model.invoiceTotal:N2}</span>");

                        col.Add(Model => Model.InvoiceType)
                            .Titled("Type")
                            .Css("text-center")
                            .Encoded(false)
                            .RenderedAs(model => $"<span class='invoice-type-cell'>{model.InvoiceType}</span>");

                        col.Add(Model => Model.Status)
                            .Titled("Status")
                            .Css("text-center")
                            .Encoded(false)
                            .RenderedAs(model =>
                            {
                                string statusClass = model.Status == IndiaLivings_Web_DAL.Models.InvoiceStatus.PENDING ? "status-pending" :
                                                     model.Status == IndiaLivings_Web_DAL.Models.InvoiceStatus.SUCCESS ? "status-paid" :
                                                     model.Status == IndiaLivings_Web_DAL.Models.InvoiceStatus.CANCELLED ? "status-cancelled" : "status-overdue";
                                return $"<span class='invoice-status-badge {statusClass}'>{model.Status}</span>";
                            });

                        col.Add(Model => Model.createdDate)
                            .Titled("Start Date")
                            .Css("text-center")
                            .Encoded(false)
                            .RenderedAs(model => $"<span class='invoice-date-cell'>{model.createdDate:MM/dd/yyyy}</span>");

                        col.Add(Model => Model.dueDate)
                            .Titled("Due Date")
                            .Css("text-center")
                            .Encoded(false)
                            .RenderedAs(model => $"<span class='invoice-date-cell'>{model.dueDate:MM/dd/yyyy}</span>");
                    })
                    .Sortable().Filterable()
                    .Empty("<div class='invoice-no-data'><i class='fas fa-folder-open'></i><h4>No Invoices Found</h4><p>You don't have any invoices yet. Once you complete a transaction, your invoices will appear here.</p></div>")
                    .Pageable(pager =>
                    {
                        pager.PageSizes = new Dictionary<Int32, String> { { 0, "All" }, { 5, "5" }, { 10, "10" }, { 50, "50" } };
                        pager.ShowPageSizes = false;
                        pager.PagesToDisplay = 3;
                        pager.CurrentPage = 1;
                        pager.RowsPerPage = 10;
                    })
                )
            }
            else
            {
                <div class="invoice-no-data">
                    <i class="fas fa-folder-open"></i>
                    <h4>No Invoices Yet</h4>
                    <p>You don't have any invoices yet. Once you complete a transaction, your invoices will appear here.</p>
                </div>
            }
        </div>
    </div>

    <div id="invoiceDetailsContainer" style="display:none; margin-top:20px;"></div>
</div>

<script src="~/js/mvc-grid/mvc-grid.js"></script>
<script>
    // Initialize MVC Grid
    document.querySelectorAll(".mvc-grid").forEach(element => new MvcGrid(element));

    // Export to CSV
    function exportToCSV() {
        alert('Export to CSV feature coming soon!');
        // Implementation for CSV export
    }

    // Print Invoices
    function printInvoices() {
        window.print();
    }

    // Filter Invoices (UI only - backend filtering can be added)
    // NOTE: keep MVC Grid pagination as provided by the library — do not hide rows client-side
    function filterInvoices(status, btn) {
        // Update active button UI only
        document.querySelectorAll('.invoice-filter-btn').forEach(b => b.classList.remove('active'));
        if (btn) btn.classList.add('active');

        // TODO: implement server-side / MVC-Grid filter integration here.
        // For now we don't manipulate rows directly so MVC Grid pagination remains intact.
        console.log('Filter requested (not applied):', status);
    }

    // Add smooth animations on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Animate stat cards
        const statCards = document.querySelectorAll('.invoice-stat-card');
        statCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            setTimeout(() => {
                card.style.transition = 'all 0.5s ease-out';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
    });
</script>