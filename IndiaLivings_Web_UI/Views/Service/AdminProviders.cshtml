@model List<ServiceProviderViewModel>
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Add these lines in the head section -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        /* Additional styles for provider management */
        .provider-profile-card {
            border: 1px solid #e3e6f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background: #fff;
            transition: all 0.3s ease;
        }

            .provider-profile-card:hover {
                border-color: #5a5c69;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }

        .provider-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid #e3e6f0;
            padding-bottom: 20px;
        }

        .provider-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #e3e6f0;
        }

        .provider-basic-info h5 {
            margin: 0 0 5px 0;
            color: #3a3b45;
        }

        .provider-basic-info p {
            margin: 0;
            color: #6c757d;
            font-size: 14px;
        }

        .provider-status {
            margin-left: auto;
            text-align: right;
        }

        .provider-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .provider-detail-item h6 {
            color: #5a5c69;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .provider-detail-item p {
            color: #3a3b45;
            font-size: 14px;
            margin: 0;
        }

        .provider-services-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .service-tag {
            background: #f1f3f4;
            color: #5a5c69;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .provider-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: end;
        }

        .status-active {
            background: #28a745;
            color: white;
        }

        .status-inactive {
            background: #6c757d;
            color: white;
        }

        .status-suspended {
            background: #dc3545;
            color: white;
        }

        .status-pending {
            background: #ffc107;
            color: #212529;
        }

        .provider-form-modal .modal-body {
            max-height: 500px;
            overflow-y: auto;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

            .form-row .form-group {
                flex: 1;
            }

        /* Add select2 specific styles */
        .select2-container {
            width: 100% !important;
        }

        .select2-selection {
            height: 38px !important;
            padding: 5px !important;
            border: 1px solid #ced4da !important;
        }

        .select2-selection__rendered {
            line-height: 28px !important;
        }

        .select2-selection__arrow {
            height: 36px !important;
        }
    </style>
    <!--=====================================
                CSS LINK PART END
    =======================================-->
</head>
<body>
    <!--=====================================
              SINGLE BANNER PART START
    =======================================-->
    <section class="single-banner admin-banner">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="single-content">
                        <h2>Service Providers Management</h2>
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a asp-controller="Dashboard" asp-action="Dashboard">Admin</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Service Providers</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--=====================================
              SINGLE BANNER PART END
    =======================================-->
    <!--=====================================
            ADMIN PROVIDERS MANAGEMENT START
    =======================================-->
    <section class="admin-providers-part">
        <div class="container">
            <!-- Providers Statistics -->
            <div class="row">
                <div class="col-lg-3 col-sm-6">
                    <div class="admin-stat-card">
                        <div class="stat-content">
                            <h4>156</h4>
                            <p>Total Providers</p>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6">
                    <div class="admin-stat-card">
                        <div class="stat-content">
                            <h4>142</h4>
                            <p>Active Providers</p>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6">
                    <div class="admin-stat-card">
                        <div class="stat-content">
                            <h4>12</h4>
                            <p>Pending Verification</p>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6">
                    <div class="admin-stat-card">
                        <div class="stat-content">
                            <h4>4.7</h4>
                            <p>Average Rating</p>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-star"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Providers Management Content -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="admin-content-card">
                        <!-- Tab Navigation -->
                        <div class="admin-tabs">
                            <ul class="nav nav-tabs" id="providersTabs">
                                <li class="nav-item">
                                    <a class="nav-link active" id="all-providers-tab" data-toggle="tab" href="#all-providers">All Providers</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="pending-verification-tab" data-toggle="tab" href="#pending-verification">Pending Verification</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="top-performers-tab" data-toggle="tab" href="#top-performers">Top Performers</a>
                                </li>
                            </ul>
                        </div>

                        <!-- Tab Content -->
                        <div class="tab-content" id="providersTabContent">
                            <!-- All Providers Tab -->
                            <div class="tab-pane fade show active" id="all-providers">
                                <div class="content-header">
                                    <h4>All Service Providers (156)</h4>
                                    <div class="content-actions">
                                        <select class="form-control form-control-sm" style="width: auto;">
                                            <option>All Categories</option>
                                            <option>Home Cleaning</option>
                                            <option>Beauty & Salon</option>
                                            <option>AC & Appliance</option>
                                            <option>Home Repair</option>
                                            <option>Tech Support</option>
                                        </select>
                                        <button class="btn btn-primary" onclick="openAddProviderModal()">
                                            <i class="fas fa-plus"></i> Add New Provider
                                        </button>
                                        <button class="btn btn-outline-secondary">
                                            <i class="fas fa-download"></i> Export
                                        </button>
                                    </div>
                                </div>

                                <div class="providers-list">
                                    @foreach (var provider in Model)
                                    {
                                        <div class="provider-profile-card">
                                            <div class="provider-header">
                                                <img src="@(provider.ProviderImage != null ? $"data:image/png;base64,{Convert.ToBase64String(provider.ProviderImage)}" : Url.Content("~/images/avatar/01.jpg")) alt="provider" class="provider-avatar">
                                                <div class="provider-basic-info">
                                                    <h5>@provider.CompanyName</h5>
                                                    <p><strong>Owner:</strong> @provider.DisplayName</p>
                                                    <p><strong>Phone:</strong> +91 @provider.Phone</p>
                                                    <p><strong>Email:</strong> @provider.Email</p>
                                                    <p><strong>Joined:</strong> March 15, 2023</p>
                                                </div>
                                                <div class="provider-status">
                                                    @if (provider != null)
                                                    {
                                                        <span class="status-badge @(provider.IsActive ? "status-active" : "status-inactive")">
                                                            @(provider.IsActive ? "Active" : "Inactive")
                                                        </span>
                                                    }
                                                    else
                                                    {
                                                        <span class="status-badge status-inactive">Unknown</span>
                                                    }
                                                    <div class="rating mt-2">
                                                        <i class="fas fa-star"></i>
                                                        <span>4.8 (245 reviews)</span>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="provider-details-grid">
                                                <div class="provider-detail-item">
                                                    <h6>Business Address</h6>
                                                    <p>@provider.AddressLine1, @provider.City, @provider.State - @provider.PostalCode</p>
                                                </div>
                                                <div class="provider-detail-item">
                                                    <h6>Service Areas</h6>
                                                    <p>Mumbai Central, Andheri, Bandra, Thane</p>
                                                </div>
                                                <div class="provider-detail-item">
                                                    <h6>Experience</h6>
                                                    <p>8 years in home cleaning services</p>
                                                </div>
                                            </div>

                                            <div class="provider-details-grid">
                                                <div class="provider-detail-item">
                                                    <h6>Services Offered</h6>
                                                    <div class="provider-services-list">
                                                        <span class="service-tag">Deep House Cleaning</span>
                                                        <span class="service-tag">Office Cleaning</span>
                                                        <span class="service-tag">Carpet Cleaning</span>
                                                        <span class="service-tag">Kitchen Deep Clean</span>
                                                    </div>
                                                </div>
                                                <div class="provider-detail-item">
                                                    <h6>Performance Stats</h6>
                                                    <p>
                                                        <strong>Completed Jobs:</strong> 1,245<br>
                                                        <strong>Success Rate:</strong> 98%<br>
                                                        <strong>Response Time:</strong> 2 hours avg
                                                    </p>
                                                </div>
                                                <div class="provider-detail-item">
                                                    <h6>Documents</h6>
                                                    <p>
                                                        <span class="badge badge-success">? ID Verified</span><br>
                                                        <span class="badge badge-success">? License Verified</span><br>
                                                        <span class="badge badge-success">? Background Check</span>
                                                    </p>
                                                </div>
                                            </div>

                                            <div class="provider-actions">
                                                <button class="btn btn-outline-primary btn-sm" onclick="viewProvider(1)">
                                                    <i class="fas fa-eye"></i> View Profile
                                                </button>
                                                <button class="btn btn-outline-secondary btn-sm" 
                                                        onclick="editProvider(this)"
                                                        data-providerid = "@provider.ProviderId"
                                                        data-companyname="@provider.CompanyName"
                                                        data-displayname="@provider.DisplayName"
                                                        data-email="@provider.Email"
                                                        data-phone="@provider.Phone"
                                                        data-address="@provider.AddressLine1"
                                                        data-country="@provider.Country"
                                                        data-city="@provider.City"
                                                        data-state="@provider.State"
                                                        data-postalcode="@provider.PostalCode">
                                                    <i class="fas fa-edit"></i> Edit
                                                </button>
                                                <button class="btn btn-outline-info btn-sm" onclick="viewProviderServices(1)">
                                                    <i class="fas fa-tools"></i> Services
                                                </button>
                                                <button class="btn btn-outline-warning btn-sm" onclick="suspendProvider(1)">
                                                    <i class="fas fa-pause"></i> Suspend
                                                </button>
                                                <button class="btn btn-outline-success btn-sm" onclick="contactProvider(1)">
                                                    <i class="fas fa-phone"></i> Contact
                                                </button>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>

                            <!-- Pending Verification Tab -->
                            <div class="tab-pane fade" id="pending-verification">
                                <div class="content-header">
                                    <h4>Pending Verification (12)</h4>
                                    <div class="content-actions">
                                        <button class="btn btn-success" onclick="approveAllSelected()">
                                            <i class="fas fa-check"></i> Approve Selected
                                        </button>
                                        <button class="btn btn-danger" onclick="rejectAllSelected()">
                                            <i class="fas fa-times"></i> Reject Selected
                                        </button>
                                    </div>
                                </div>

                                <div class="providers-list">
                                    <!-- Pending Provider Card -->
                                    <div class="provider-profile-card">
                                        <div class="provider-header">
                                            <input type="checkbox" class="provider-checkbox" value="4" style="margin-right: 15px;">
                                            <img src="~/images/avatar/04.jpg" alt="provider" class="provider-avatar">
                                            <div class="provider-basic-info">
                                                <h5>Cool Tech AC Services</h5>
                                                <p><strong>Owner:</strong> Amit Patel</p>
                                                <p><strong>Phone:</strong> +91 9876543213</p>
                                                <p><strong>Email:</strong> amit@cooltech.com</p>
                                                <p><strong>Applied:</strong> December 20, 2023</p>
                                            </div>
                                            <div class="provider-status">
                                                <span class="status-badge status-pending">Pending Verification</span>
                                            </div>
                                        </div>

                                        <div class="provider-details-grid">
                                            <div class="provider-detail-item">
                                                <h6>Business Address</h6>
                                                <p>321 AC Service Center, Pune, Maharashtra - 411001</p>
                                            </div>
                                            <div class="provider-detail-item">
                                                <h6>Service Areas</h6>
                                                <p>Pune City, Pimpri, Chinchwad</p>
                                            </div>
                                            <div class="provider-detail-item">
                                                <h6>Experience</h6>
                                                <p>10 years in AC repair and maintenance</p>
                                            </div>
                                        </div>

                                        <div class="provider-details-grid">
                                            <div class="provider-detail-item">
                                                <h6>Proposed Services</h6>
                                                <div class="provider-services-list">
                                                    <span class="service-tag">AC Repair</span>
                                                    <span class="service-tag">AC Installation</span>
                                                    <span class="service-tag">AC Maintenance</span>
                                                    <span class="service-tag">Gas Refilling</span>
                                                </div>
                                            </div>
                                            <div class="provider-detail-item">
                                                <h6>Previous Experience</h6>
                                                <p>
                                                    <strong>Years in Business:</strong> 10<br>
                                                    <strong>Team Size:</strong> 5 technicians<br>
                                                    <strong>Certifications:</strong> Available
                                                </p>
                                            </div>
                                            <div class="provider-detail-item">
                                                <h6>Documents Status</h6>
                                                <p>
                                                    <span class="badge badge-warning">? ID Verification</span><br>
                                                    <span class="badge badge-warning">? License Review</span><br>
                                                    <span class="badge badge-danger">? Background Check</span>
                                                </p>
                                            </div>
                                        </div>

                                        <div class="provider-actions">
                                            <button class="btn btn-primary btn-sm" onclick="reviewApplication(4)">
                                                <i class="fas fa-search"></i> Review Application
                                            </button>
                                            <button class="btn btn-success btn-sm" onclick="approveProvider(4)">
                                                <i class="fas fa-check"></i> Approve
                                            </button>
                                            <button class="btn btn-danger btn-sm" onclick="rejectProvider(4)">
                                                <i class="fas fa-times"></i> Reject
                                            </button>
                                            <button class="btn btn-outline-info btn-sm" onclick="requestMoreInfo(4)">
                                                <i class="fas fa-info"></i> Request Info
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Top Performers Tab -->
                            <div class="tab-pane fade" id="top-performers">
                                <div class="content-header">
                                    <h4>Top Performing Providers</h4>
                                    <div class="content-actions">
                                        <select class="form-control form-control-sm" style="width: auto;">
                                            <option>This Month</option>
                                            <option>Last 3 Months</option>
                                            <option>This Year</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Rank</th>
                                                <th>Provider</th>
                                                <th>Category</th>
                                                <th>Completed Jobs</th>
                                                <th>Rating</th>
                                                <th>Revenue</th>
                                                <th>Growth</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <span class="badge badge-warning">?? 1</span>
                                                </td>
                                                <td>
                                                    <div class="provider-info">
                                                        <img src="~/images/avatar/02.jpg" alt="provider" class="table-avatar">
                                                        <span>Bella Beauty Salon</span>
                                                    </div>
                                                </td>
                                                <td>Beauty & Salon</td>
                                                <td>156</td>
                                                <td>
                                                    <div class="rating">
                                                        <i class="fas fa-star"></i>
                                                        <span>4.9</span>
                                                    </div>
                                                </td>
                                                <td>?2,45,680</td>
                                                <td><span class="text-success">+23%</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary" onclick="viewProvider(2)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <span class="badge badge-secondary">?? 2</span>
                                                </td>
                                                <td>
                                                    <div class="provider-info">
                                                        <img src="~/images/avatar/01.jpg" alt="provider" class="table-avatar">
                                                        <span>Clean Pro Services</span>
                                                    </div>
                                                </td>
                                                <td>Home Cleaning</td>
                                                <td>134</td>
                                                <td>
                                                    <div class="rating">
                                                        <i class="fas fa-star"></i>
                                                        <span>4.8</span>
                                                    </div>
                                                </td>
                                                <td>?1,89,450</td>
                                                <td><span class="text-success">+18%</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary" onclick="viewProvider(1)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <span class="badge badge-warning">?? 3</span>
                                                </td>
                                                <td>
                                                    <div class="provider-info">
                                                        <img src="~/images/avatar/03.jpg" alt="provider" class="table-avatar">
                                                        <span>Fix It Fast</span>
                                                    </div>
                                                </td>
                                                <td>Home Repair</td>
                                                <td>89</td>
                                                <td>
                                                    <div class="rating">
                                                        <i class="fas fa-star"></i>
                                                        <span>4.6</span>
                                                    </div>
                                                </td>
                                                <td>?1,56,320</td>
                                                <td><span class="text-success">+15%</span></td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary" onclick="viewProvider(3)">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--=====================================
            ADMIN PROVIDERS MANAGEMENT END
    =======================================-->
    <!-- Add/Edit Provider Modal -->
    <div class="modal fade provider-form-modal" id="providerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="providerModalTitle">Add New Service Provider</h5>
                    <button type="button" class="close" data-bs-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="providerForm">
                        <div class="form-group">
                            <input type="hidden" class="form-control" name="ProviderId" id="providerId" value="0">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Business Name *</label>
                                <input type="text" class="form-control" name="CompanyName" id="businessName" required>
                            </div>
                            <div class="form-group">
                                <label>Owner Name *</label>
                                <input type="text" class="form-control" name="DisplayName" id="ownerName" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email *</label>
                                <input type="email" class="form-control" name="Email" id="email" required>
                            </div>
                            <div class="form-group">
                                <label>Phone Number *</label>
                                <input type="tel" class="form-control" name="Phone" id="phone" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Address Line 1 *</label>
                                <input class="form-control" id="address" name="AddressLine1" rows="2" required />
                            </div>
                            <div class="form-group">
                                <label>Address Line 2 *</label>
                                <input class="form-control" id="address" name="AddressLine2" rows="2" required />
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Service Category *</label>
                                <select class="form-control" id="category" required>
                                    <option value="">Select Category</option>
                                    <option value="home-cleaning">Home Cleaning</option>
                                    <option value="beauty-salon">Beauty & Salon</option>
                                    <option value="ac-appliance">AC & Appliance</option>
                                    <option value="home-repair">Home Repair</option>
                                    <option value="tech-support">Tech Support</option>
                                    <option value="painting">Painting</option>
                                    <option value="car-care">Car Care</option>
                                    <option value="moving">Moving</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Experience (Years)</label>
                                <input type="number" class="form-control" id="experience" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="countriesDropdown" class="form-label">Country</label>
                                <select id="countriesDropdown" class="form-control" style="width: 100%" value="" placeholder="select a country">India</select>
                            </div>
                            <div class="form-group">
                                <label for="statesDropdown" class="form-label">State</label>
                                <select id="statesDropdown" class="form-control" style="width: 100%" value="@Context.Session.GetString("State")"></select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="citiesDropdown" class="form-label">City</label>
                                <select id="citiesDropdown" class="form-control" style="width: 100%" value="@Context.Session.GetString("City")"></select>
                            </div>
                            <div class="form-group">
                                <label for="pincode" class="form-label">Pincode</label>
                                <input id="pincode" class="form-control" name="pincode" style="width: 100%" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="form-group">
                                <label>Alt Phone Number *</label>
                                <input type="tel" class="form-control" name="AltPhone" id="phone" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Service Areas</label>
                            <input type="text" class="form-control" id="serviceAreas" placeholder="e.g., Mumbai Central, Andheri, Bandra">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea class="form-control" id="description" rows="3" name="description" placeholder="Brief description of services and experience"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Profile Image</label>
                            <input type="file" class="form-control" name="ProviderImage" id="profileImage" accept="image/*">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveProvider()">
                        <i class="fas fa-save"></i> Save Provider
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!--=====================================
                JS LINK PART START
    =======================================-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        // Provider Management Functions
        function openAddProviderModal() {
            $('#providerModalTitle').text('Add New Service Provider');
            $('#providerForm')[0].reset();
            $('#providerModal').modal('show');
        }

        function editProvider(btn) {
            $('#providerModalTitle').text('Edit Service Provider');
            $('#businessName').val($(btn).data('companyname'));
            $('#ownerName').val($(btn).data('displayname'));
            $('#email').val($(btn).data('email'));
            $('#phone').val($(btn).data('phone'));
            $('#address').val($(btn).data('address'));
            $('#ProviderId').val($(btn).data('providerid'));
            
            const countryToSet = $(btn).data('country');
            const stateToSet = $(btn).data('state');
            const cityToSet = $(btn).data('city');
            
            // Set country first (assuming India)
            $('#countriesDropdown').val('91').trigger('change');
            
            // Wait for states to load then set state
            setTimeout(() => {
                // Find and set state by name
                let stateOption = $('#statesDropdown option').filter(function() {
                    return $(this).text().trim() === stateToSet;
                });
                if (stateOption.length) {
                    $('#statesDropdown').val(stateOption.val()).trigger('change');
                    
                    // Wait for cities to load then set city
                    setTimeout(() => {
                        // Find and set city by name
                        let cityOption = $('#citiesDropdown option').filter(function() {
                            return $(this).text().trim() === cityToSet;
                        });
                        if (cityOption.length) {
                            $('#citiesDropdown').val(cityOption.val()).trigger('change');
                        }
                    }, 2000);
                }
            }, 3000);
            
            $('#pincode').val($(btn).data('postalcode'));
            $('#providerModal').modal('show');
            
        }

        function viewProvider(providerId) {
            alert('Opening detailed view for provider: ' + providerId);
            // Open provider details modal or page
        }

        function viewProviderServices(providerId) {
            alert('Viewing services for provider: ' + providerId);
            // Show provider's services
        }

        function suspendProvider(providerId) {
            if (confirm('Are you sure you want to suspend this provider? They will not be able to receive new bookings.')) {
                alert('Provider suspended: ' + providerId);
                // Handle provider suspension
            }
        }

        function contactProvider(providerId) {
            alert('Opening contact options for provider: ' + providerId);
            // Show contact methods (call, email, message)
        }

        function approveProvider(providerId) {
            if (confirm('Approve this provider and activate their account?')) {
                alert('Provider approved: ' + providerId);
                // Handle provider approval
            }
        }

        function rejectProvider(providerId) {
            const reason = prompt('Please provide a reason for rejection:');
            if (reason) {
                alert('Provider rejected: ' + providerId + '\nReason: ' + reason);
                // Handle provider rejection
            }
        }

        function reviewApplication(providerId) {
            alert('Opening detailed application review for provider: ' + providerId);
            // Open detailed application review modal
        }

        function requestMoreInfo(providerId) {
            const info = prompt('What additional information do you need from this provider?');
            if (info) {
                alert('Information request sent to provider: ' + providerId + '\nRequested: ' + info);
                // Send info request to provider
            }
        }

        function approveAllSelected() {
            const selected = $('.provider-checkbox:checked').length;
            if (selected > 0) {
                if (confirm('Approve ' + selected + ' selected providers?')) {
                    alert('Approved ' + selected + ' providers');
                    // Handle bulk approval
                }
            } else {
                alert('Please select providers to approve');
            }
        }

        function rejectAllSelected() {
            const selected = $('.provider-checkbox:checked').length;
            if (selected > 0) {
                const reason = prompt('Please provide a reason for bulk rejection:');
                if (reason) {
                    alert('Rejected ' + selected + ' providers\nReason: ' + reason);
                }
            } else {
                alert('Please select providers to reject');
            }
        }

        function saveProvider() {
            let formData = new FormData(document.getElementById('providerForm'));
            formData.set('Country', $('#countriesDropdown').find('option:selected').text());
            formData.set('State', $('#statesDropdown').find('option:selected').text());
            formData.set('City', $('#citiesDropdown').find('option:selected').text());
            $.ajax({
                url: '/Service/CreateServiceProvider',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    alert('Provider saved successfully!');
                    $('#providerModal').modal('hide');
                    // Optionally refresh the provider list
                },
                error: function() {
                    alert('Failed to save provider. Please try again.');
                }
            });
        }



        // Auto-refresh provider data every 60 seconds
        setInterval(function() {
            console.log('Refreshing provider data...');
        }, 60000);

        $(document).ready(function () {
                $.ajax({
                    url: '/User/GetCountryName',
                    type: 'GET',
                    success: function (response) {
                        if (typeof response === "string") {
                            response = JSON.parse(response);
                        }

                        const countries = response
                            .filter(c => c && c.strCountryName)
                            .sort((a, b) => a.strCountryName.localeCompare(b.strCountryName));

                        let $dropdown = $('#countriesDropdown');
                        $dropdown.empty();

                        $dropdown.append('<option value="">Please select your country</option>');

                        countries.forEach(function (country) {
                            $dropdown.append(
                                $('<option></option>')
                                    .val(country.intCountryID)
                                    .text(country.strCountryName)
                            );
                        });
                        const selectedCountry = "".trim();
                        if (selectedCountry) {
                            let matchedOption = $dropdown.find('option').filter(function () {
                                return $(this).text().trim() === selectedCountry;
                            }).first();
                            if (matchedOption.length) {
                                $dropdown.val(matchedOption.val()).trigger('change');
                            }
                        } else {
                            // Default to "Please select your country"
                            $dropdown.val("").trigger('change');
                        }

                        $dropdown.select2({
                            placeholder: "Select a country",
                            allowClear: true
                        });
                    },
                    error: function () {
                        alert('Failed to load countries');
                    }
                });

            $('#countriesDropdown').on('change', function () {
                const selectedCountryId = $(this).val();
                if (selectedCountryId) {
                    $.ajax({
                        url: '/Dashboard/GetStates',
                        type: 'GET',
                        data: {countryId: selectedCountryId},
                        success: function (states) {
                            if (typeof states === "string") {
                                states = JSON.parse(states);
                            }

                            const filteredStates = states
                                .filter(s => s && s.strStateName && s.IsActive)
                                .sort((a, b) => a.strStateName.localeCompare(b.strStateName));

                            let $stateDropdown = $('#statesDropdown');
                            $stateDropdown.empty().append('<option>Select your state</option>');

                            filteredStates.forEach(function (state) {
                                $stateDropdown.append(
                                    $('<option></option>')
                                        .val(state.intStateID)
                                        .text(state.strStateName)
                                );
                            });

                            const selectedState = "".trim();
                            if (selectedState) {
                                let matchedOption = $stateDropdown.find('option').filter(function () {
                                    return $(this).text().trim() === selectedState;
                                }).first();
                                if (matchedOption.length) {
                                    $stateDropdown.val(matchedOption.val()).trigger('change');
                                }
                            } else {
                                $stateDropdown.val("").trigger('change');
                            }

                            $stateDropdown.select2({
                                placeholder: "Select a state",
                                allowClear: true
                            });
                        },
                        error: function () {
                            alert('Failed to load states');
                        }
                    });
                } else {
                    $('#statesDropdown').empty().trigger('change');
                }
            });

            $('#statesDropdown').on('change', function () {
                const selectedStateId = $(this).val();
                if (selectedStateId) {
                    $.ajax({
                        url: '/Dashboard/GetCities',
                        type: 'GET',
                        data: {stateId: selectedStateId},
                        success: function (cities) {
                            if (typeof cities === "string") {
                                cities = JSON.parse(cities);
                            }

                            const filteredCities = cities
                                .filter(s => s && s.strCityName && s.IsActive)
                                .sort((a, b) => a.strCityName.localeCompare(b.strCityName));

                            let $cityDropdown = $('#citiesDropdown');
                            $cityDropdown.empty().append('<option>Select your City</option>');

                            filteredCities.forEach(function (city) {
                                $cityDropdown.append(
                                    $('<option></option>')
                                        .val(city.intCityID)
                                        .text(city.strCityName)
                                );
                            });

                            const selectedCity = "@Context.Session.GetString("City")".trim();
                            if (selectedCity) {
                                let matchedOption = $cityDropdown.find('option').filter(function () {
                                    return $(this).text().trim() === selectedCity;
                                }).first();
                                if (matchedOption.length) {
                                    $cityDropdown.val(matchedOption.val()).trigger('change');
                                }
                            } else {
                                // Default to "Please select your country"
                                $cityDropdown.val("").trigger('change');
                            }

                            $stateDropdown.select2({
                                placeholder: "Select a city",
                                allowClear: true
                            });
                        },
                        error: function () {
                            alert('Failed to load cities');
                        }
                    });
                } else {
                    $('#citiesDropdown').empty().trigger('change');
                }
            });

            // Initialize select2
            $('#countriesDropdown, #statesDropdown, #citiesDropdown').select2({
                width: '100%',
                placeholder: "Please select"
            });
        });
    </script>
    <!--=====================================
                JS LINK PART END
    =======================================-->
</body>
</html>