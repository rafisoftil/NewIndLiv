@model List<ServiceBookingViewModel>
@{
    ViewBag.Title = "My Services";
    var upcomingCount = Model.Count(b => b.StatusName == "Pending");
    var completedCount = Model.Count(b => b.StatusName == "Completed");
    var cancelledCount = Model.Count(b => b.StatusName == "Cancelled");
}
<!--=====================================
            SINGLE BANNER PART START
=======================================-->
<section class="single-banner dashboard-banner">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="single-content">
                    <h2>My Services</h2>
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a asp-controller="Dashboard" asp-action="Dashboard">Home</a></li>
                        <li class="breadcrumb-item active" aria-current="page">My Services</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</section>
<!--=====================================
            SINGLE BANNER PART END
=======================================-->
<!--=====================================
        DASHBOARD HEADER PART START
=======================================-->
<section class="dash-header-part">
    <div class="container">
        <div class="dash-header-card">
            <div class="row">
                <div class="col-lg-3 col-sm-6">
                    <div class="dash-count-card">
                        <div class="dash-count-text">
                            <h4>@Model.Count()</h4>
                            <p>Total Bookings</p>
                        </div>
                        <div class="dash-count-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6">
                    <div class="dash-count-card">
                        <div class="dash-count-text">
                            <h4>@upcomingCount</h4>
                            <p>Upcoming Services</p>
                        </div>
                        <div class="dash-count-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6">
                    <div class="dash-count-card">
                        <div class="dash-count-text">
                            <h4>@completedCount</h4>
                            <p>Completed Services</p>
                        </div>
                        <div class="dash-count-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6">
                    <div class="dash-count-card">
                        <div class="dash-count-text">
                            <h4>?18,540</h4>
                            <p>Total Spent</p>
                        </div>
                        <div class="dash-count-icon">
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!--=====================================
        DASHBOARD HEADER PART END
=======================================-->
<!--=====================================
        MY SERVICES PART START
=======================================-->
<section class="my-services-part">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="my-services-content">
                    <!-- Filter Tabs -->
                    <div class="services-filter">
                        <ul class="nav nav-tabs" id="servicesTabs">
                            <li class="nav-item">
                                <a class="nav-link active" id="all-tab" data-toggle="tab" href="#all-services">All Services</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="upcoming-tab" data-toggle="tab" href="#upcoming-services">Upcoming</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="completed-tab" data-toggle="tab" href="#completed-services">Completed</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="cancelled-tab" data-toggle="tab" href="#cancelled-services">Cancelled</a>
                            </li>
                        </ul>
                    </div>

                    <div class="tab-content" id="servicesTabContent">
                        <div class="tab-pane fade show active" id="all-services">
                            <div class="services-list">
                                <!-- Service Booking Item -->
                                @foreach (var booking in Model)
                                {
                                    <div class="service-booking-item">
                                        <div class="booking-status">
                                            <span class="status-badge upcoming">@booking.StatusName</span>
                                        </div>
                                        <div class="booking-content">
                                            <div class="service-info">
                                                <div class="service-image">
                                                    <img src="~/images/product/01.jpg" alt="service" onerror="this.style.display='none'; this.parentElement.innerHTML='<div class=&quot;image-placeholder&quot; style=&quot;display:flex;flex-direction:column;align-items:center;justify-content:center;height:80px;background-color:#f8f9fa;color:#6c757d;&quot;><i class=&quot;fas fa-home&quot; style=&quot;font-size:24px;margin-bottom:5px;&quot;></i><span>Cleaning</span></div>';">
                                                </div>
                                                <div class="service-details">
                                                    <h4>@booking.ServiceName</h4>
                                                    <p class="provider-name">
                                                        <i class="fas fa-user"></i>
                                                        @booking.ProviderName
                                                    </p>
                                                    <p class="booking-date">
                                                        <i class="fas fa-calendar"></i>
                                                        Dec 25, 2023 - Morning (8:00 AM - 12:00 PM)
                                                    </p>
                                                    <p class="booking-address">
                                                        <i class="fas fa-map-marker-alt"></i>
                                                        @booking.AddressLine1
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="booking-meta">
                                                <div class="booking-price">
                                                    <span class="price">?@booking.PriceQuoted</span>
                                                    <small>Total Amount</small>
                                                </div>
                                                <div class="booking-actions">
                                                    <button class="btn btn-outline-primary btn-sm" onclick="viewBookingDetails('@booking.BookingId')">
                                                        <i class="fas fa-eye"></i> View Details
                                                    </button>
                                                    <button class="btn btn-outline-danger btn-sm" data-bookingId="@booking.BookingId" onclick="cancelBooking('@booking.BookingId')">
                                                        <i class="fas fa-times"></i> Cancel
                                                    </button>
                                                    <button class="btn btn-primary btn-sm" onclick="contactProvider('@booking.BookingId')">
                                                        <i class="fas fa-phone"></i> Contact
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="quick-actions-card">
                                    <h4>Quick Actions</h4>
                                    <div class="actions-grid">
                                        <a href="services-list.html" class="action-item">
                                            <i class="fas fa-search"></i>
                                            <span>Book New Service</span>
                                        </a>
                                        <a href="#" class="action-item">
                                            <i class="fas fa-heart"></i>
                                            <span>Favorite Providers</span>
                                        </a>
                                        <a href="#" class="action-item">
                                            <i class="fas fa-receipt"></i>
                                            <span>Service History</span>
                                        </a>
                                        <a href="#" class="action-item">
                                            <i class="fas fa-headset"></i>
                                            <span>Customer Support</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<div class="modal fade" id="CancelBookingModal" tabindex="-1" aria-labelledby="cancelBookingLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">   
                <form>
                    <input type="hidden" id="CancelBookingId" />
                    <div class="form-group">
                        <label for="Reason">Please provide a reason for Cancelling</label>
                        <input type="text" id="Reason" class="form-control" />
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="BookingCancel()">Submit</button>
            </div>
        </div>
    </div>
</div>
<div id="spinner" class="d-none">
    <img style="height: 100px" src="~/images/spinner.gif" />
</div>
<div id="toast" class="d-none"></div>
<!--=====================================
        MY SERVICES PART END
=======================================-->
<!--=====================================
            JS LINK PART START
=======================================-->
<script>
    // JavaScript functions for booking actions
    function viewBookingDetails(bookingId) {
        alert('Viewing details for booking: ' + bookingId);
        // Redirect to booking details page
    }

    function cancelBooking(bookingId) {
        if(confirm('Are you sure you want to cancel this booking?')) {
            $('#CancelBookingId').val(bookingId);
            $('#CancelBookingModal').modal('show');
        }
    }
    function BookingCancel() {
        var bookingId = $('#CancelBookingId').val();
        var reason = $('#Reason').val();

        if (!reason) {
            errors.push('Please enter the reason');
            $('#Reason').addClass('is-invalid');
        } else if (reason.length > 250) {
            errors.push('Reason cannot exceed 250 characters.');
            $('#Reason').addClass('is-invalid');
        } else {
            $('#Reason').removeClass('is-invalid');
        }

        $.ajax({
            url: '@Url.Action("CancelBooking", "Service")',
            type: 'POST',
            data: {bookingId: bookingId, reason: reason},
            success: function(response) {
                if (response.success) {
                    ShowToast('success', 'Booking successfully Cancelled');
                    location.reload();
                } else {
                    ShowToast('failed', 'Booking Cancelling Unsuccessful');
                }
            },
            error: function() {
                ShowToast('failed', 'An error occured while cancelling');
            }
        });
    }

    function contactProvider(bookingId) {
        alert('Contacting provider for booking: ' + bookingId);
        // Open contact modal or redirect to contact page
    }

    function rateService(bookingId) {
        alert('Rating service for booking: ' + bookingId);
        // Open rating modal
    }

    function rebookService(bookingId) {
        alert('Rebooking service for booking: ' + bookingId);
        // Redirect to service booking page
    }

    function rescheduleBooking(bookingId) {
        alert('Rescheduling booking: ' + bookingId);
        // Open reschedule modal
    }
</script>
<!--=====================================
            JS LINK PART END
=======================================-->
