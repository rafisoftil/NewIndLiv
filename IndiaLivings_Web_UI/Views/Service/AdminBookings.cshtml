@{
    var title = "Admin - Bookings Management";
    List<UserBookingResponseViewModel> Bookings = Model is List<UserBookingResponseViewModel> ? Model : Model.Bookings;
    List<ServiceProviderViewModel> Providers = Model is List<ServiceProviderViewModel> ? new List<ServiceProviderViewModel>() : Model.Providers;
    List<UserBookingResponseViewModel> PendingBookings = Bookings.Where(b => b.Status == "PENDING").ToList();
    List<UserBookingResponseViewModel> AssignedBookings = Bookings.Where(b => b.Status == "ASSIGNED").ToList();
    List<UserBookingResponseViewModel> CompletedBookings = Bookings.Where(b => b.Status == "ASSIGNED").ToList();
}
<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        /* Additional styles for bookings management */
        .booking-item {
            border: 1px solid #e3e6f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background: #fff;
            transition: all 0.3s ease;
        }

            .booking-item:hover {
                border-color: #5a5c69;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            }

        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #e3e6f0;
            padding-bottom: 15px;
        }

        .booking-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .booking-customer {
            display: flex;
            align-items: center;
            gap: 10px;
        }

            .booking-customer img {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                object-fit: cover;
            }

        .booking-details {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        .detail-item h6 {
            color: #5a5c69;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .detail-item p {
            color: #3a3b45;
            font-size: 14px;
            margin: 0;
        }

        .booking-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .provider-assignment {
            background: #f8f9fc;
            border: 1px solid #e3e6f0;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .status-pending {
            background: #ffc107;
            color: #212529;
        }

        .status-assigned {
            background: #17a2b8;
            color: white;
        }

        .status-confirmed {
            background: #28a745;
            color: white;
        }

        .status-completed {
            background: #6c757d;
            color: white;
        }

        .status-cancelled {
            background: #dc3545;
            color: white;
        }

        .provider-card {
            border: 1px solid #e3e6f0;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

            .provider-card:hover {
                border-color: #5a5c69;
                background: #f8f9fc;
            }

            .provider-card.selected {
                border-color: #4e73df;
                background: #f0f6ff;
            }

        .provider-details {
            display: flex;
            align-items: center;
            gap: 10px;
        }

            .provider-details img {
                width: 35px;
                height: 35px;
                border-radius: 50%;
                object-fit: cover;
            }

        .provider-stats {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }
    </style>
    <!--=====================================
                CSS LINK PART END
    =======================================-->
</head>
<body>
    <!--=====================================
              SINGLE BANNER PART START
    =======================================-->
    <section class="single-banner admin-banner">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="single-content">
                        <h2>Bookings Management</h2>
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a asp-controller="Dashboard" asp-action="Dashboard">Admin</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Bookings Management</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--=====================================
              SINGLE BANNER PART END
    =======================================-->
    <!--=====================================
            ADMIN BOOKINGS MANAGEMENT START
    =======================================-->
    <section class="admin-bookings-part">
        <div class="container">
            <!-- Bookings Statistics -->
            <div class="row">
                <div class="col-lg-3 col-sm-6">
                    <div class="admin-stat-card">
                        <div class="stat-content">
                            <h4>@Bookings.Count()</h4>
                            <p>Total Bookings</p>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6">
                    <div class="admin-stat-card">
                        <div class="stat-content">
                            <h4>@PendingBookings.Count()</h4>
                            <p>Pending Assignment</p>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6">
                    <div class="admin-stat-card">
                        <div class="stat-content">
                            <h4>@AssignedBookings.Count()</h4>
                            <p>Active Bookings</p>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6">
                    <div class="admin-stat-card">
                        <div class="stat-content">
                            <h4>?1,24,560</h4>
                            <p>Total Revenue</p>
                        </div>
                        <div class="stat-icon">
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bookings Management Content -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="admin-content-card">
                        <!-- Tab Navigation -->
                        <div class="admin-tabs">
                            <ul class="nav nav-tabs" id="bookingsTabs">
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" id="pending-tab" href="#pending-bookings">Pending Assignment</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" id="assigned-tab" href="#assigned-bookings">Assigned Bookings</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" id="completed-tab" href="#completed-bookings">Completed</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" id="all-tab" href="#all-bookings">All Bookings</a>
                                </li>
                            </ul>
                        </div>

                        <div class="tab-content" id="bookingsTabContent"> 
                                <div class="tab-pane fade show active" id="pending-bookings">
                                    <div class="content-header">
                                        <h4>Pending Assignment (23)</h4>
                                        <div class="content-actions">
                                            <select class="form-control form-control-sm" style="width: auto;">
                                                <option>All Categories</option>
                                                <option>Home Cleaning</option>
                                                <option>Beauty & Salon</option>
                                                <option>AC & Appliance</option>
                                                <option>Home Repair</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="bookings-list">
                                        <!-- Pending Assignment Tab -->
                                        @foreach (var booking in PendingBookings)
                                        {
                                            <div class="booking-item">
                                                <div class="booking-header">
                                                    <div class="booking-info">
                                                        <div class="booking-id">
                                                            <h6>Booking @booking.BookingId</h6>
                                                            <span class="status-badge status-@(booking.Status.ToLower())">@booking.Status Assignment</span>
                                                        </div>
                                                        <div class="booking-customer">
                                                            <img src="~/images/avatar/01.jpg" alt="customer">
                                                            <div>
                                                                <h6>@* @booking.CustomerName *@</h6>
                                                                <small>+91 @* @booking.CustomerPhone *@</small>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="booking-date">
                                                        <small>Booked: @booking.RequestedStartAt</small>
                                                    </div>
                                                </div>

                                                <div class="booking-details">
                                                    <div class="detail-item">
                                                        <h6>Service</h6>
                                                        <p>@booking.ServiceName</p>
                                                        <small>@booking.ServiceName</small>
                                                    </div>
                                                    <div class="detail-item">
                                                        <h6>Scheduled Date & Time</h6>
                                                        <p>Dec 26, 2023</p>
                                                        <small>10:00 AM - 2:00 PM</small>
                                                    </div>
                                                    <div class="detail-item">
                                                        <h6>Service Address</h6>
                                                        @* <p>@booking.AddressLine1, @booking.AddressLine2</p> *@
                                                        <small>@booking.City, @booking.State @* - @booking.PostalCode *@</small>
                                                    </div>
                                                </div>

                                                <div class="booking-details">
                                                    <div class="detail-item">
                                                        <h6>Service Amount</h6>
                                                        <p>₹@booking.PriceQuoted</p>
                                                    </div>
                                                    <div class="detail-item">
                                                        <h6>Payment Status</h6>
                                                        <p><span class="badge badge-success">Paid</span></p>
                                                    </div>
                                                    <div class="detail-item">
                                                        <h6>Special Instructions</h6>
                                                        <p>@* @booking.Notes *@</p>
                                                    </div>
                                                </div>
                                                <div class="booking-actions">
                                                    <button class="btn btn-outline-primary btn-sm" onclick="viewBookingDetails('bk001')">
                                                        <i class="fas fa-eye"></i> View Details
                                                    </button>
                                                    <button class="btn btn-outline-danger btn-sm" onclick="cancelBooking('@booking.BookingId')">
                                                        <i class="fas fa-times"></i> Cancel Booking
                                                    </button>
                                                </div>
                                                <div class="provider-assignment">
                                                    <h6>Assign Service Provider</h6>
                                                    <div class="available-providers" id="providers-bk001">
                                                        @foreach (var provider in Providers)
                                                        {
                                                            <div class="provider-card">
                                                                <div class="provider-details">
                                                                    <img src="~/images/avatar/01.jpg" alt="provider">
                                                                    <div>
                                                                        <strong>@provider.CompanyName</strong>
                                                                        <div class="provider-stats">
                                                                            <span>@provider.ContactName</span>
                                                                            @* <span>? 4.8 (245 reviews)</span> *@
                                                                            @* <span>?? 2.5 km away</span>
                                                                            <span>? Available</span> *@
                                                                            <span>@provider.AddressLine1, @provider.AddressLine2, @provider.City, @provider.State, @provider.PostalCode</span>
                                                                            <span>@provider.Email</span>
                                                                            <span>@provider.Phone</span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="ms-auto">
                                                                        <button class="btn btn-success btn-sm" onclick="selectProvider('@booking.BookingId', '@provider.ProviderId')">
                                                                            <i class="fas fa-user-check"></i> Assign Provider
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        }
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    
                                    </div>
                                </div>
                           
                                <!-- Assigned Bookings Tab -->
                                <div class="tab-pane fade" id="assigned-bookings">
                                    <div class="content-header">
                                        <h4>Assigned Bookings (89)</h4>
                                        <div class="content-actions">
                                            <button class="btn btn-outline-secondary btn-sm">
                                                <i class="fas fa-download"></i> Export
                                            </button>
                                        </div>
                                    </div>

                                    <div class="table-responsive">
                                        <table class="table table-striped" id="assignedBookingsTable">
                                            <thead>
                                                <tr>
                                                    <th>Booking ID</th>
                                                    <th>Customer</th>
                                                    <th>Service</th>
                                                    <th>Provider</th>
                                                    <th>Scheduled Date</th>
                                                    <th>Amount</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            @foreach (var booking in AssignedBookings)
                                                {
                                                    <tr>
                                                        <td>@booking.BookingId</td>
                                                        <td>
                                                            <div class="customer-info">
                                                                <img src="~/images/avatar/02.jpg" alt="customer" class="table-avatar">
                                                                <span>@* @booking.CustomerName *@</span>
                                                            </div>
                                                        </td>
                                                        <td>@booking.ServiceName</td>
                                                        <td>@booking.ProviderName</td>
                                                        <td>@booking.RequestedStartAt<br><small>6:00 PM</small></td>
                                                        <td>₹@booking.PriceQuoted</td>
                                                        <td><span class="status-badge status-@(booking.Status.ToLower())">@booking.Status</span></td>
                                                        <td>
                                                            <div class="action-buttons">
                                                                <button class="btn btn-sm btn-outline-primary" onclick="viewBookingDetails('BK003')">
                                                                    <i class="fas fa-eye"></i>
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-warning" onclick="reassignProvider('BK003')">
                                                                    <i class="fas fa-user-edit"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <!-- Completed Bookings Tab -->
                                <div class="tab-pane fade" id="completed-bookings">
                                    <div class="content-header">
                                        <h4>Completed Bookings (44)</h4>
                                    </div>

                                    <div class="table-responsive">
                                        <table class="table table-striped" id="completedBookingsTable">
                                            <thead>
                                                <tr>
                                                    <th>Booking ID</th>
                                                    <th>Customer</th>
                                                    <th>Service</th>
                                                    <th>Provider</th>
                                                    <th>Completed Date</th>
                                                    <th>Amount</th>
                                                    <th>Rating</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var booking in CompletedBookings)
                                                {
                                                    <tr>
                                                        <td>@booking.BookingId</td>
                                                        <td>
                                                            <div class="customer-info">
                                                                <img src="~/images/avatar/01.jpg" alt="customer" class="table-avatar">
                                                                <span>@* @booking.CustomerName *@</span>
                                                            </div>
                                                        </td>
                                                        <td>@booking.ServiceName</td>
                                                        <td>@booking.ProviderName</td>
                                                        <td>@booking.RequestedEndAt</td>
                                                        <td>₹@booking.PriceQuoted</td>
                                                        <td>
                                                            <div class="rating">
                                                                <i class="fas fa-star"></i>
                                                                <span>4.5</span>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="action-buttons">
                                                                <button class="btn btn-sm btn-outline-primary" onclick="viewBookingDetails('BK005')">
                                                                    <i class="fas fa-eye"></i>
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-secondary" onclick="generateInvoice('BK005')">
                                                                    <i class="fas fa-file-pdf"></i>
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="all-bookings">
                                    <div class="content-header">
                                        <h4>All Bookings (156)</h4>
                                        <div class="content-actions">
                                            <input type="text" class="form-control form-control-sm" placeholder="Search bookings..." style="width: 200px; display: inline-block;">
                                            <button class="btn btn-outline-secondary btn-sm">
                                                <i class="fas fa-download"></i> Export All
                                            </button>
                                        </div>
                                    </div>

                                    <div class="table-responsive">
                                        <table class="table table-striped" id="allBookingsTable">
                                            <thead>
                                                <tr>
                                                    <th>Booking ID</th>
                                                    <th>Customer</th>
                                                    <th>Service</th>
                                                    <th>Provider</th>
                                                    <th>Date</th>
                                                    <th>Amount</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var booking in Bookings)
                                                {
                                                    <tr>
                                                        <td>@booking.BookingId</td>
                                                        <td>@booking.ProviderName</td>
                                                        <td>@booking.ServiceName</td>
                                                        <td>@booking.ProviderName</td>
                                                        <td>@booking.RequestedStartAt</td>
                                                        <td>₹@booking.PriceQuoted</td>
                                                        <td><span class="status-badge status-@(booking.Status.ToLower())">@booking.Status</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-primary" onclick="viewBookingDetails('BK001')">
                                                                <i class="fas fa-eye"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div class="modal fade" id="CancelBookingModal" tabindex="-1" aria-labelledby="cancelBookingLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <form>
                        <input type="hidden" id="CancelBookingId" />
                        <div class="form-group">
                            <label for="Reason">Please provide a reason for Cancelling</label>
                            <textarea id="Reason" class="form-control"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="BookingCancel()">Submit</button>
                </div>
            </div>
        </div>
    </div>
    <div id="spinner" class="d-none">
        <img style="height: 100px" src="~/images/spinner.gif" />
    </div>
    <div id="toast" class="d-none"></div>
    <!--=====================================
            ADMIN BOOKINGS MANAGEMENT END
    =======================================-->
    <!--=====================================
                JS LINK PART START
    =======================================-->
    <script>
        // Booking Management Functions
        function selectProvider(bookingId, providerId) {
            // Remove selection from all providers for this booking
            // $('#providers-' + bookingId + ' .provider-card').removeClass('selected');

            // // Add selection to clicked provider
            // event.currentTarget.classList.add('selected');

            // // Store selected provider
            // window.selectedProviders = window.selectedProviders || {};
            // window.selectedProviders[bookingId] = providerId;
            $.ajax({
                type: "POST",
                url: '/Service/AssignProvider',
                data: { bookingId: bookingId, providerId: providerId },
                success: function (response) {
                    if (response.success) {
                        ShowToast('success', 'Service Assigned Successfully');
                        location.reload();
                    } else {
                        ShowToast('failed', 'Opeartion Unsuccessful');
                    }
                },
                error: function () {
                    ShowToast('failed', 'An error occurred while selecting the provider.');
                }
            });
        }
        
        
        function cancelBooking(bookingId) {
            if(confirm('Are you sure you want to cancel this booking?')) {
                $('#CancelBookingId').val(bookingId);
                $('#CancelBookingModal').modal('show');
            }
        }
        function BookingCancel() {
            var bookingId = $('#CancelBookingId').val();
            var reason = $('#Reason').val();
            var errors = [];

            if (!reason) {
                errors.push('Please enter the reason');
                $('#Reason').addClass('is-invalid');
            } else if (reason.length > 250) {
                errors.push('Reason cannot exceed 250 characters.');
                $('#Reason').addClass('is-invalid');
            } else {
                $('#Reason').removeClass('is-invalid');
            }
            if (errors.length > 0) {
                ShowToast('failed', errors.join('\n'));
                return false;
            }

            $.ajax({
                url: '@Url.Action("CancelBooking", "Service")',
                type: 'POST',
                data: {bookingId: bookingId, reason: reason},
                success: function(response) {
                    if (response.success) {
                        ShowToast('success', 'Booking successfully Cancelled');
                        location.reload();
                    } else {
                        ShowToast('failed', 'Booking Cancelling Unsuccessful');
                    }
                },
                error: function() {
                    ShowToast('failed', 'An error occured while cancelling');
                }
            });
        }
        // function cancelBooking(bookingId, providerId) {
        //     // Remove selection from all providers for this booking
        //     // $('#providers-' + bookingId + ' .provider-card').removeClass('selected');

        //     // // Add selection to clicked provider
        //     // event.currentTarget.classList.add('selected');

        //     // // Store selected provider
        //     // window.selectedProviders = window.selectedProviders || {};
        //     // window.selectedProviders[bookingId] = providerId;
        //     $.ajax({
        //         type: "POST",
        //         url: '/Service/CancelBooking',
        //         data: { bookingId: bookingId, providerId: providerId },
        //         success: function (response) {
        //             if (response.success) {
        //                 ShowToast('success', 'Booking Cancelled Successfully');
        //                 location.reload();
        //             } else {
        //                 ShowToast('failed', 'Opeartion Unsuccessful');
        //             }
        //         },
        //         error: function () {
        //             ShowToast('failed', 'An error occurred while selecting the provider.');
        //         }
        //     });
        // }

        function assignProvider(bookingId) {
            const selectedProvider = window.selectedProviders && window.selectedProviders[bookingId];
            if (!selectedProvider) {
                alert('Please select a service provider first');
                return;
            }

            if (confirm('Are you sure you want to assign this provider to the booking?')) {
                alert('Provider assigned successfully! Customer and provider will be notified.');
                // Handle provider assignment
            }
        }

        function viewBookingDetails(bookingId) {
            alert('Opening detailed view for booking: ' + bookingId);
            // Open booking details modal
        }

        // function cancelBooking(bookingId) {
        //     if (confirm('Are you sure you want to cancel this booking? This action cannot be undone.')) {
        //         alert('Booking cancelled. Customer will be notified and refund will be processed.');
        //         // Handle booking cancellation
        //     }
        // }

        function reassignProvider(bookingId) {
            alert('Opening provider reassignment for booking: ' + bookingId);
            // Open reassignment modal
        }

        function generateInvoice(bookingId) {
            alert('Generating invoice for booking: ' + bookingId);
            // Generate PDF invoice
        }

        // Auto-refresh bookings every 30 seconds
        setInterval(function() {
            console.log('Refreshing bookings data...');
        }, 30000);
    </script>
    <!--=====================================
                JS LINK PART END
    =======================================-->
</body>
</html>